{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container my-4">

  <a class="text-decoration-none" href="{% url 'school_lessons' classroom.id %}">← Back to lessons</a>

  <div class="mt-2 mb-3">
    <h3 class="fw-bold mb-1">{{ lesson.title }}</h3>
    <div class="text-muted small">
      {{ school.name }} • {{ classroom.name }} • XP: {{ lesson.xp }}
    </div>
  </div>

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-success">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <!-- ✅ VIDEO (same as your parent lesson template) -->
  {% if lesson.youtube_id %}
    <div class="text-center my-4">
      <a href="{{ lesson.youtube_watch_url }}" target="_blank" rel="noopener">
        <img
          src="{{ lesson.youtube_thumbnail }}"
          alt="Watch lesson video"
          class="img-fluid rounded shadow"
          style="max-width: 720px;"
        >
      </a>

      <div class="mt-3">
        <a
          href="{{ lesson.youtube_watch_url }}"
          target="_blank"
          rel="noopener"
          class="btn btn-danger px-4"
        >
          ▶ Watch on YouTube
        </a>
      </div>

      <div class="small text-muted mt-2">
        After watching, complete the activity below to earn your badge.
      </div>
    </div>
  {% endif %}

  <!-- ✅ LESSON CONTENT -->
  {% if lesson.content %}
    <div class="bg-white border rounded-4 shadow-sm p-4 mb-4">
      {{ lesson.content|linebreaks }}
    </div>
  {% endif %}

  <!-- ✅ ACTIVITY (reuse your existing activity blocks) -->
  {% if lesson.activity_type == "order" %}
    {% include "activities/order_block.html" %}
  {% elif lesson.activity_type == "choice" %}
    {% include "activities/choice_block.html" %}
  {% elif lesson.activity_type == "keyboard" %}
    {% include "activities/keyboard_game_activity.html" %}
  {% elif lesson.activity_type == "mouse" %}
    {% include "activities/mouse_practice.html" %}
  {% elif lesson.activity_type == "tidy_computer" %}
    {% include "activities/tidy_computer.html" %}
  {% else %}
    <div class="alert alert-info">
      No activity for this lesson yet.
    </div>
  {% endif %}

  <!-- ✅ MARK COMPLETE -->
  <div class="bg-white border rounded-4 shadow-sm p-4 mt-4">
    <h5 class="fw-semibold mb-3">Mark complete for a student</h5>

    <div class="row g-2">
      {% for s in students %}
        <div class="col-md-6">
          <div class="d-flex justify-content-between align-items-center border rounded-3 p-3">
            <div>
              <div class="fw-semibold">{{ s.name }}</div>
              <div class="small text-muted">⭐ XP: {{ s.xp }}</div>
            </div>

            <form method="post" action="{% url 'school_complete_lesson' classroom.id lesson.id s.id %}">
              {% csrf_token %}
              <button class="btn btn-primary btn-sm">Complete +XP</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

</div>

{% endblock %}
